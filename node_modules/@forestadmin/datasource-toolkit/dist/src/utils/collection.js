"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const factory_1 = __importDefault(require("../interfaces/query/condition-tree/factory"));
const unpaginated_1 = __importDefault(require("../interfaces/query/filter/unpaginated"));
const factory_2 = __importDefault(require("../interfaces/query/filter/factory"));
const projection_1 = __importDefault(require("../interfaces/query/projection"));
const schema_1 = __importDefault(require("./schema"));
class CollectionUtils {
    static getFieldSchema(collection, path) {
        const { fields } = collection.schema;
        const index = path.indexOf(':');
        if (index === -1) {
            if (!fields[path])
                throw new Error(`Column not found '${collection.name}.${path}'`);
            return fields[path];
        }
        const associationName = path.substring(0, index);
        const schema = fields[associationName];
        if (!schema) {
            throw new Error(`Relation not found '${collection.name}.${associationName}'`);
        }
        if (schema.type !== 'ManyToOne' && schema.type !== 'OneToOne') {
            throw new Error(`Unexpected field type '${schema.type}': '${collection.name}.${associationName}'`);
        }
        return CollectionUtils.getFieldSchema(collection.dataSource.getCollection(schema.foreignCollection), path.substring(index + 1));
    }
    static getInverseRelation(collection, relationName) {
        const relation = collection.schema.fields[relationName];
        const foreignCollection = collection.dataSource.getCollection(relation.foreignCollection);
        const inverse = Object.entries(foreignCollection.schema.fields).find(([, field]) => {
            const isManyToManyInverse = field.type === 'ManyToMany' &&
                relation.type === 'ManyToMany' &&
                field.originKey === relation.foreignKey &&
                field.throughCollection === relation.throughCollection &&
                field.foreignKey === relation.originKey;
            const isManyToOneInverse = field.type === 'ManyToOne' &&
                (relation.type === 'OneToMany' || relation.type === 'OneToOne') &&
                field.foreignKey === relation.originKey;
            const isOtherInverse = (field.type === 'OneToMany' || field.type === 'OneToOne') &&
                relation.type === 'ManyToOne' &&
                field.originKey === relation.foreignKey;
            return ((isManyToManyInverse || isManyToOneInverse || isOtherInverse) &&
                field.foreignCollection === collection.name);
        });
        return inverse ? inverse[0] : null;
    }
    static getThroughOrigin(collection, relationName) {
        const relation = collection.schema.fields[relationName];
        if (relation.type !== 'ManyToMany')
            throw new Error('Relation must be many to many');
        const throughCollection = collection.dataSource.getCollection(relation.throughCollection);
        const originRelation = Object.entries(throughCollection.schema.fields).find(([, field]) => {
            return (field.type === 'ManyToOne' &&
                field.foreignCollection === collection.name &&
                field.foreignKey === relation.originKey &&
                field.foreignKeyTarget === relation.originKeyTarget);
        });
        return originRelation ? originRelation[0] : null;
    }
    static getThroughTarget(collection, relationName) {
        const relation = collection.schema.fields[relationName];
        if (relation.type !== 'ManyToMany')
            throw new Error('Relation must be many to many');
        const throughCollection = collection.dataSource.getCollection(relation.throughCollection);
        const foreignRelation = Object.entries(throughCollection.schema.fields).find(([, field]) => {
            return (field.type === 'ManyToOne' &&
                field.foreignCollection === relation.foreignCollection &&
                field.foreignKey === relation.foreignKey &&
                field.foreignKeyTarget === relation.foreignKeyTarget);
        });
        return foreignRelation ? foreignRelation[0] : null;
    }
    static async listRelation(collection, id, relationName, caller, foreignFilter, projection) {
        const relation = schema_1.default.getToManyRelation(collection.schema, relationName);
        const foreign = collection.dataSource.getCollection(relation.foreignCollection);
        // Optimization for many to many when there is not search/segment.
        if (relation.type === 'ManyToMany' && foreignFilter.isNestable) {
            const foreignRelation = CollectionUtils.getThroughTarget(collection, relationName);
            if (foreignRelation) {
                const through = collection.dataSource.getCollection(relation.throughCollection);
                const records = await through.list(caller, await factory_2.default.makeThroughFilter(collection, id, relationName, caller, foreignFilter), projection.nest(foreignRelation));
                return records.map(r => r[foreignRelation]);
            }
        }
        // Otherwise fetch the target table (this works with both relation types)
        return foreign.list(caller, await factory_2.default.makeForeignFilter(collection, id, relationName, caller, foreignFilter), projection);
    }
    static async aggregateRelation(collection, id, relationName, caller, foreignFilter, aggregation, limit) {
        const relation = schema_1.default.getToManyRelation(collection.schema, relationName);
        const foreign = collection.dataSource.getCollection(relation.foreignCollection);
        // Optimization for many to many when there is not search/segment (saves one query)
        if (relation.type === 'ManyToMany' && foreignFilter.isNestable) {
            const foreignRelation = CollectionUtils.getThroughTarget(collection, relationName);
            if (foreignRelation) {
                const through = collection.dataSource.getCollection(relation.throughCollection);
                const records = await through.aggregate(caller, await factory_2.default.makeThroughFilter(collection, id, relationName, caller, foreignFilter), aggregation.nest(foreignRelation), limit);
                // unnest aggregation result
                return records.map(({ value, group }) => ({
                    value,
                    group: Object.entries(group)
                        .map(([key, v]) => [key.substring(key.indexOf(':') + 1), v])
                        .reduce((memo, [key, v]) => ({ ...memo, [key]: v }), {}),
                }));
            }
        }
        // Otherwise fetch the target table (this works with both relation types)
        return foreign.aggregate(caller, await factory_2.default.makeForeignFilter(collection, id, relationName, caller, foreignFilter), aggregation, limit);
    }
    static async getValue(collection, caller, id, field) {
        const index = schema_1.default.getPrimaryKeys(collection.schema).indexOf(field);
        if (index !== -1)
            return id[index];
        const [record] = await collection.list(caller, new unpaginated_1.default({ conditionTree: factory_1.default.matchIds(collection.schema, [id]) }), new projection_1.default(field));
        return record[field];
    }
}
exports.default = CollectionUtils;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9jb2xsZWN0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBS0EseUZBQThFO0FBQzlFLHlGQUE0RDtBQUM1RCxpRkFBK0Q7QUFFL0QsZ0ZBQXdEO0FBQ3hELHNEQUFtQztBQUVuQyxNQUFxQixlQUFlO0lBQ2xDLE1BQU0sQ0FBQyxjQUFjLENBQUMsVUFBc0IsRUFBRSxJQUFZO1FBQ3hELE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQ3JDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFaEMsSUFBSSxLQUFLLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxxQkFBcUIsVUFBVSxDQUFDLElBQUksSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDO1lBRXBGLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3JCO1FBRUQsTUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDakQsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBbUIsQ0FBQztRQUV6RCxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ1gsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsVUFBVSxDQUFDLElBQUksSUFBSSxlQUFlLEdBQUcsQ0FBQyxDQUFDO1NBQy9FO1FBRUQsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLFdBQVcsSUFBSSxNQUFNLENBQUMsSUFBSSxLQUFLLFVBQVUsRUFBRTtZQUM3RCxNQUFNLElBQUksS0FBSyxDQUNiLDBCQUEwQixNQUFNLENBQUMsSUFBSSxPQUFPLFVBQVUsQ0FBQyxJQUFJLElB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